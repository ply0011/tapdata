riot.tag2("diagrammenu",'<div> <div> <div class="diagrammenu-panel diagrammenu"> <div class="row"> <div class="component widget text-center"> <a href="#" onclick="{zoomout}"> <div data-type="textinput"> <div class="title" style="margin-bottom:10px;"><i class="fa fa-search-minus fa-2x"></i>Zoom In</div> </div> </a> </div> <div class="component widget text-center"> <a href="#" onclick="{zoomin}"> <div data-type="textinput"> <div class="title" style="margin-bottom:10px;"><i class="fa fa-search-plus fa-2x"></i>Zoom Out</div> </div> </a> </div> <div class="component widget text-center"> <a href="#" onclick="{savedocument}"> <div data-type="textinput"> <div class="title" style="margin-bottom:10px;"><img src="images/save.png">Save</div> </div> </a> </div> <div class="component widget text-center"> <a href="#" onclick="{cancel}"> <div data-type="textinput"> <div class="title" style="margin-bottom:10px;"><img src="images/cancel.png">Cancel</div> </div> </a> </div> <div class="component widget text-center"> <a href="#" onclick="{display}"> <div data-type="textinput"> <div class="title" style="margin-bottom:10px;"><img src="images/preview.png">Preview</div> </div> </a> </div> <div class="btn-group text-center"> <label><input type="checkbox" name="showRelation" __checked="{document.showRelation?true:false}" onclick="{showRelationchange}">Show ER Relationship</label> </div> <div class="component widget text-center"> <label><input type="checkbox" name="showSimple" __checked="{document.mode==\'simple\'?true:false}" onclick="{showSimplechange}">Simple Mode</label> </div> </div> </div> </div> <input type="file" style="display: none" id="documentFile" accept="text/plain">',"#menu li{ margin-bottom:0px; } .menu_title{ margin-bottom:-5px; font-size:9pt; } #menu.nav.nav-tabs li a{ padding-top:5px; padding-bottom:5px; } .diagrammenu .select2-container .select2-choice, .diagrammenu .select2-container-multi .select2-choices { padding-top:0px; height:30px; margin-top:0px; border-top:0px solid #dbdbdb; border-left:0px solid #dbdbdb; border-right:0px solid #dbdbdb; border-bottom:0px solid #dbdbdb; border-image-width:0px; -webkit-border-radius: 0px; -moz-border-radius: 0px; border-radius: 0px; background:white; filter: none; -webkit-box-shadow: inset 0 0px 0px rgba(0, 0, 0, 0.075); -moz-box-shadow: inset 0 0px 0px rgba(0, 0, 0, 0.075); box-shadow: inset 0 0px 0px rgba(0, 0, 0, 0.075); } .diagrammenu .sp-replacer { margin:0; overflow:hidden; cursor:pointer; height:32px; padding: 5px 4px 4px 3px; margin-top:0px; display:inline-block; *zoom: 1; *display: inline; border-top-width:0px; border-bottom:0px solid black; border:0px solid black; vertical-align: middle; } .diagrammenu .sp-replacer:hover, .diagrammenu .sp-replacer.sp-active { border-color: #aaa; border-bottom-width:0px; border-top-width:0px; } .btn-toolbaritem{ min-width:44px; height:32px; } .diagrammenu .btn-default{ backgroud:#d7dee3; border:none; } ul.dropdown-menu>li>a{ padding:5px 20px !important; } .diagrammenu .component{ padding: 10px 10px; width:140px; display:inline-block; }","",function(t){this.designer=t,this.document=t.document,this.activePanel=t.document.activePanel.instance,this.height=this.activePanel.canvas.height,this.width=this.activePanel.canvas.width,this.focuswidget=function(){return e.activePanel.focuswidget},this.defaultfont=this.document.defaultfont,this.defaultconnectionType=function(){return this.document.defaultconnectionType},this.defaulttableconnectionType=this.document.defaulttableconnectionType,this.defaultentityconnectionType=this.document.defaultentityconnectionType;var e=this,i=localStorage.getItem("visor_windows");i=null===i?{property:1,navigation:1,templatelist:1}:JSON.parse(i);var n=function(e){for(s in e){var i=s;1===e[i]?$("#view-options").find("a[alt="+i+"]").find("i").removeClass("fa-square-o").addClass("fa-check-square-o"):$("#view-options").find("a[alt="+i+"]").find("i").removeClass("fa-check-square-o").addClass("fa-square-o")}1===e.property?$(".propertyEditForm").show():$(".propertyEditForm").hide(),1===e.navigation?$("#navigation").show():$("#navigation").hide(),1===e.property?$("#panel_propertyEditor").show():$("#panel_propertyEditor").hide(),$("#panel_workspace").removeClass("col-lg-8").removeClass("col-lg-12").addClass("col-lg-10"),t.trigger("showproperty",1===e.property)};this.designer.on("openpropertypanel",function(t){null!=t&&(i.property=t),e.openproperty()}),this.designer.on("openwidgetpanel",function(){e.openwidget()}),this.openproperty=function(){var t="property";1===i[t]?(i[t]=0,$("#view-options").find("a[alt=property]").find("i").removeClass("fa-check-square-o").addClass("fa-square-o")):(i[t]=1,$("#view-options").find("a[alt=property]").find("i").removeClass("fa-square-o").addClass("fa-check-square-o")),localStorage.setItem("visor_windows",JSON.stringify(i)),n(i)}.bind(this),this.openwidget=function(){var t="navigation";1===i[t]?(i[t]=0,$("#view-options").find("a[alt=navigation]").find("i").removeClass("fa-check-square-o").addClass("fa-square-o")):(i[t]=1,$("#view-options").find("a[alt=navigation]").find("i").removeClass("fa-square-o").addClass("fa-check-square-o")),localStorage.setItem("visor_windows",JSON.stringify(i)),n(i)}.bind(this),this.lock=function(){e.focuswidget()&&(e.focuswidget().editable=!e.focuswidget().editable),e.activePanel.paint()}.bind(this),this.duplicate=function(){e.document.activePanel.copy(),e.document.activePanel.paste()}.bind(this),this.paste=function(){e.document.activePanel.paste()}.bind(this),this.removewidget=function(){e.activePanel.deleteFocus()}.bind(this),this.bringfont=function(){e.activePanel.focuswidget.topDepth(),e.activePanel.paint()}.bind(this),this.setback=function(){e.activePanel.focuswidget.downDepth(),e.activePanel.paint()}.bind(this),this.savedocument=function(e){e.preventDefault(),e.stopPropagation(),t.trigger("savedocument")}.bind(this),this.cancel=function(){t.trigger("cancel")}.bind(this);this.display=function(e){var i={};$.extend(i,this.document.persist()),e.preventDefault(),e.stopPropagation(),t.trigger("preview",i)}.bind(this),this.alignleft=function(){for(var t=e.activePanel,i=0,n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&(i=0==i?t.selectwidgets[n].x:Math.min(i,t.selectwidgets[n].x));for(var n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&(t.selectwidgets[n].x=i);t.paint()}.bind(this),this.alignright=function(){for(var t=e.activePanel,i=0,n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&(i=0==i?t.selectwidgets[n].x+t.selectwidgets[n].width:Math.max(i,t.selectwidgets[n].x+t.selectwidgets[n].width));for(var n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&(t.selectwidgets[n].x=i-t.selectwidgets[n].width);t.paint()}.bind(this),this.alignequalwidth=function(){for(var t=e.activePanel,i=[],n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&i.push(t.selectwidgets[n]);for(var a=Math.round(t.selectRect.width/i.length),n=0;n<i.length;n++)i[n].x=t.selectRect.x+n*a;t.paint()}.bind(this),this.aligncenterhorizontal=function(){for(var t=e.activePanel,i=t.selectRect.y+t.selectRect.height/2,n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&(t.selectwidgets[n].y=i-t.selectwidgets[n].height/2);t.paint()}.bind(this),this.aligntop=function(){for(var t=e.activePanel,i=0,n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&(i=0==i?t.selectwidgets[n].y:Math.min(i,t.selectwidgets[n].y));for(var n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&(t.selectwidgets[n].y=i);t.paint()}.bind(this),this.alignbottom=function(){for(var t=e.activePanel,i=0,n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&(i=0==i?t.selectwidgets[n].y+t.selectwidgets[n].height:Math.max(i,t.selectwidgets[n].y+t.selectwidgets[n].height));for(var n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&(t.selectwidgets[n].y=i-t.selectwidgets[n].height);t.paint()}.bind(this),this.alignequalheight=function(){for(var t=e.activePanel,i=[],n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&i.push(t.selectwidgets[n]);for(var a=Math.round(t.selectRect.height/i.length),n=0;n<i.length;n++)i[n].y=t.selectRect.y+n*a;t.paint()}.bind(this),this.aligncentervertical=function(){for(var t=e.activePanel,i=t.selectRect.x+t.selectRect.width/2,n=0;n<t.selectwidgets.length;n++)t.selectwidgets[n].type.indexOf("Connector")<0&&(t.selectwidgets[n].x=i-t.selectwidgets[n].width/2);t.paint()}.bind(this),this.showRelationchange=function(t){var i=t.currentTarget,n=i.checked;name=i.name,e.document[name]=n;for(var a=e.document.activePanel.instance,o=0;o<=a.widgets.length-1;o++)"relationConnector"==a.widgets[o].type&&(a.widgets[o].visible=n);a.paint()}.bind(this),this.showSimplechange=function(t){var i=t.currentTarget,n=i.checked;name=i.name,e.document[name]=n;for(var a=e.document.activePanel.instance,o=0;o<=a.widgets.length-1;o++)"table"==a.widgets[o].type&&(a.widgets[o].mode=n?"simple":"full");a.paint()}.bind(this),this.zoomout=function(){var t=(e.activePanel,e.activePanel.scale||1);t-.1>.3&&(t-=.1),e.activePanel.Scale(t),e.document.activePanel.Scale(t),e.document.activePanel.instance.paint()}.bind(this),this.zoomin=function(){var t=e.activePanel,i=t.scale||1;i+.1<2.1&&(i+=.1),t.Scale(i),e.document.activePanel.Scale(i),e.document.activePanel.instance.paint()}.bind(this),this.designer.on("undo",function(){e.undo()}),this.designer.on("redo",function(){e.redo()}),this.redo=function(){if(e.activePanel.redohistory.length>0){var t=e.activePanel.redohistory[e.activePanel.redohistory.length-1];t.redo(),e.activePanel.history.push(t),e.activePanel.redohistory.splice(e.activePanel.redohistory.length-1,1)}}.bind(this),this.undo=function(){if(e.activePanel.history.length>0){var t=e.activePanel.history[e.activePanel.history.length-1];t.undo(),e.activePanel.redohistory.push(t),e.activePanel.history.splice(e.activePanel.history.length-1,1)}}.bind(this),this.filter=function(){$("#modalFilters").modal("show")}.bind(this),this.fontnamechange=function(){var t=$("#fontname").select2("val");e.focuswidget()&&e.focuswidget().font?(e.focuswidget().font.family=t,e.activePanel.paint()):e.defaultfont.family=t}.bind(this),this.fontcolorchange=function(){var t=$("#fontcolor").val();e.focuswidget()&&e.focuswidget().font?(e.focuswidget().font.color=""===t?"none":t,e.activePanel.paint()):e.defaultfont.color=t}.bind(this),this.fontsizechange=function(){var t=$("#fontsize").select2("val");e.focuswidget()&&e.focuswidget().font?(e.focuswidget().font.size=t,e.activePanel.paint()):e.defaultfont.size=t}.bind(this),this.on("update",function(){this.focuswidget()&&this.focuswidget().font?($(".fontname").select2("val",this.focuswidget().font.family||"宋体"),$(".fontsize").select2("val",this.focuswidget().font.size),$("#fontcolor").spectrum("set",this.focuswidget().font.color)):($(".fontname").select2("val",this.defaultfont.family),$(".fontsize").select2("val",this.defaultfont.size),$("#fontcolor").spectrum("set",this.defaultfont.color))}),this.on("mount",function(){function t(t){return/^[0-9]*[1-9][0-9]*$/.test(t)}var i,n=[{id:"6pt",text:"6pt"},{id:"7pt",text:"7pt"},{id:"8pt",text:"8pt"},{id:"9pt",text:"9pt"},{id:"10pt",text:"10pt"},{id:"11pt",text:"11pt"},{id:"12pt",text:"12pt"},{id:"13pt",text:"13pt"},{id:"14pt",text:"14pt"},{id:"15pt",text:"15pt"},{id:"16pt",text:"16pt"},{id:"18pt",text:"18pt"},{id:"20pt",text:"20pt"},{id:"22pt",text:"22pt"},{id:"24pt",text:"24pt"},{id:"26pt",text:"26pt"},{id:"28pt",text:"28pt"},{id:"30pt",text:"30pt"},{id:"36pt",text:"36pt"},{id:"40pt",text:"40pt"},{id:"48pt",text:"48pt"},{id:"72pt",text:"72pt"}];$(".fontsize").select2({data:n,formatSelection:function(t){return t.text},formatResult:function(t){return t.text},formatNoMatches:function(t){return"输入数字"},createSearchChoice:function(e){if(t(e))return i={id:e+"pt",text:e+"pt"}}}),$(".colorpick").spectrum({showInput:!0,allowEmpty:!0,cancelText:"取消",chooseText:"选择",showInitial:!0,showPalette:!0,showSelectionPalette:!0,palette:[],preferredFormat:"hex"}),this.focuswidget()?($(".fontname").select2("val",this.focuswidget().font.family),$(".fontsize").select2("val",this.focuswidget().font.size),$("#fontcolor").spectrum("set",this.focuswidget().font.color)):($(".fontname").select2("val",this.defaultfont.family),$(".fontsize").select2("val",this.defaultfont.size),$("#fontcolor").spectrum("set",this.defaultfont.color)),$(this.root).find(".btn-zoom").on("click",function(){var t=parseInt($(this).attr("value"))/100;e.activePanel&&(e.activePanel.Scale(t),$(e.activePanel.canvas).css("height",e.activePanel.canvas.height*t),e.update())})})});